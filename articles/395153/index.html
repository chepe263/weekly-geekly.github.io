<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add a furigana to a kanji Python macro for LibreOffice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ladies and gentlemen, the plan is: 



- everything you wanted to know about Japanese writing but were afraid to ask 
- what is ruby ‚Äã‚Äãtext 
- how to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add a furigana to a kanji Python macro for LibreOffice</h1><div class="post__text post__text-html js-mediator-article">  Ladies and gentlemen, the plan is: <br><br><ul><li>  everything you wanted to know about Japanese writing but were afraid to ask </li><li>  what is ruby ‚Äã‚Äãtext </li><li>  how to write addons for libreoffice in python </li><li>  how to generate reading for kanzi </li><li>  Putting it all together in a furiganizer! </li></ul><br><img src="https://habrastorage.org/files/cc5/24f/513/cc524f513715442397b9e3abaff3612f.png"><br><br><a name="habracut"></a><br>  In modern Japanese, there are mainly three written systems. 
      <br>
        <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"></script>')</script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push({});
        </script>
      <br>
      First, these are two syllabary alphabets: hiragana and katakana.  Hiragana is more rounded, it looks like this: „Åì „Çå „ÅØ „Å≤ „Çâ „Åå „Å™ „Åß „Åô and is, as it were, the main alphabet.  Katakana is more angular („Ç´ „Çø „Ç´ „Éä „Éá) and is used mainly for borrowed words, but the whole set of hiragana and katakana is almost the same.  Then we will call all this simply ‚Äúkana‚Äù.  ‚ÄúThe syllabary alphabet‚Äù means that instead of our vowels and consonants ‚Äúa‚Äù, ‚Äúb‚Äù and ‚Äúc‚Äù - only whole syllables like ‚Äúka‚Äù, ‚Äúca‚Äù and ‚Äúthat‚Äù.  There are five vowels, though there are five pieces (‚Äúa‚Äù, ‚Äúi‚Äù, ‚Äúu‚Äù, ‚Äúe‚Äú, ‚Äúo‚Äù + ‚ÄúI‚Äù, ‚Äúy‚Äù and ‚Äúe‚Äù) and only one consonant ‚Äún‚Äù in exception order. <br><br>  That is why it is very difficult for the Japanese to pronounce the words with consecutive consonants - they are simply not used to this, but this does not matter to us now.  In principle, one cana can write any phrase in Japanese. <br><br>  Another system is the hieroglyphs borrowed from China, which we will further call <b>kanji</b> , after that they are so called.  After borrowing, the Japanese, and sobsno the Chinese, too, the kanji changed significantly, and now they are quite different, although of course, on the other hand, they were largely similar.  Let's just say, looking at the Chinese text, the Japanese can more or less understand what they are talking about.  Kanji looks like this: Âèã ÈÅî „ÄÅ Êó•Êú¨ ÈÖí „ÄÅ ‰∏ñÁïå„ÄÇ Yes, in Japanese - a round dot. <br><br>  Here is the key point for understanding: Japanese and Chinese at the grammar level are not at all related.  So just take Chinese signs and start writing with them was not possible.  Actually, using kanji, you can write individual words, or rather even the basics of words, and kana is still used to indicate grammatical forms and the connection between words.  It looks like this: ÈÄÅ „Çä „Åå „Å™ „ÅØ „Å® „Å£ „Å¶ „ÇÇ ‰æøÂà© „Åß „Åô.  If you look closely, you can see that the first character is kanji, followed by several kana characters, etc.  This trick is easy to visually distinguish Japanese text from Chinese, which looks graphically more ‚Äúdense‚Äù because  there is only kanji.  This kana, which clings to kanji to indicate grammatical form, is called ‚Äúokurigana‚Äù. <br><br>  Well, finally ... The number of kanji is quite large, and if you are not a robot, then everything is difficult to remember.  If a word is written in a kanji, it is often not obvious how to read it yourself, despite the fact that in oral speech the word could easily occur and the person knows it.  To help in this situation, especially for rare kanji or when the text is intended for children, foreigners, or other mentally limited categories of citizens - reading kanji is signed from above using kana.  This is called <b>furigana</b> .  It looks like the picture at the beginning of the post. <br><br>  Fuh, go to the next item. <br><br>  To add annotation over the text is used the so-called ruby.  It has no relation to the programming language.  As I just learned from Wikipedia - in Russian is called <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B3%25D0%25B0%25D1%2582_(%25D0%25BA%25D0%25B5%25D0%25B3%25D0%25BB%25D1%258C)">‚Äúagate‚Äù</a> <br><br>  Ruby support is in html using a ruby ‚Äã‚Äãtag: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ruby</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rt</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ruby</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  But now we are interested in LibreOffice.  In manual mode, you can add a Ruby annotation to the text through the menu Format -&gt; Asian Phonetic Guide.  This is somewhat strange, because it is possible to use the field not only for phonetics, but figs with them.  If this is not in the menu, then you can try to add support for Asian languages ‚Äã‚Äãin Tools -&gt; Options -&gt; Language Settings. <br><br>  Next, we want to do this automatically for the selected text.  LibreOffice is beautiful because you can write macros in Python.  To do this, there should be a module libreoffice-script-provider-python (put through apt-get), which is not worth it by default.  Oh yeah, I do everything under Ubuntu, if you have another operating system, then you can share a recipe for it in the comments :) <br><br>  Actually, the macro is written as a normal function on Python.  The document is visible through a global variable with the instance of the corresponding class and, in fact, it contains all the necessary methods. <br><br>  Here is a simple example: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloWorldPython</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> desktop = XSCRIPTCONTEXT.getDesktop() model = desktop.getCurrentComponent() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> hasattr(model, <span class="hljs-string"><span class="hljs-string">"Text"</span></span>): model = desktop.loadComponentFromURL(<span class="hljs-string"><span class="hljs-string">"private:factory/swriter"</span></span>,<span class="hljs-string"><span class="hljs-string">"_blank"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, () ) text = model.Text tRange = text.End tRange.String = <span class="hljs-string"><span class="hljs-string">"Hello World (in Python)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> g_exportedScripts = HelloWorldPython,</code> </pre><br><br>  Save to file, put it or make a symbolic link in the folder in which LibreOffice holds the scripts.  In my case, this is ‚Äú~ / .config / libreoffice / 4 / user / Scripts / python‚Äù. <br><br>  Open LibreOffice Writer (OpenOffice should work too), go to Tools -&gt; Macros -&gt; Run Macro and see our script there, if everything worked out. <br><br>  It remains to write a script that would take the kanji from the document and add their readings in the corresponding characters in ruby.  Everything is simple: to generate the reading there are special programs, we simply run them from our macro script, run the Japanese text through standard I / O and insert an output into the document. <br><br>  A program called kakasi takes the Japanese text and gives a reading to the whole piece, but this is not exactly what is needed, because  I want to distribute the fragments of the phonetic prompt between the ruby ‚Äã‚Äãfields of the corresponding symbols.  To do this, with the help of mecab, you can tokenize the Japanese text, and therefore already feed it kakasi in parts.  In fact, the accuracy of reading generation slightly deteriorates from this, but the layout of the document improves.  Any flaws can then be corrected manually. <br><br>  That's all, set up apt-get kakasi, mecab, <br>  go to <a href="https://github.com/undertherain/furiganize">github.com/undertherain/furiganize</a> , download the clumsy script that I wrote and which myself, but this is all done.  Put it in the desired folder and enjoy.  If someone shares his experience with other operating systems, it will be great in general. </div><p>Source: https://habr.com/ru/post/395153/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../395143/index.html">Is it possible to introduce ethics into the robots algorithm?</a></li>
<li><a href="../395145/index.html">Ask Ethan # 59: What is dark energy?</a></li>
<li><a href="../395147/index.html">Mitsubishi Outlander SUV is easily cracked over Wi-Fi</a></li>
<li><a href="../395149/index.html">A new explanation of the principle of the "impossible" engine EmDrive: these are all photons</a></li>
<li><a href="../395151/index.html">Chief in climate in your house. TION MagicAir Announcement</a></li>
<li><a href="../395155/index.html">Smart light: lighting control capabilities</a></li>
<li><a href="../395157/index.html">Progress of car DVRs and comparing them with action cameras</a></li>
<li><a href="../395159/index.html">Special project: Solar power station on autocamp. Part 1</a></li>
<li><a href="../39516/index.html">Openmokast - the first device based on the smartphone Openmoko</a></li>
<li><a href="../395161/index.html">Amazon robots do their job 4 times faster than humans.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>